// raktar-backend/prisma/schema.prisma
generator client {
  provider   = "prisma-client-js"
  engineType = "binary"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum Role {
  NEZELODO
  KEZELO
  ADMIN
}

enum ProductCategory {
  ELEKTRONIKA
  ELELMISZER
  VEGYSZER
  IRODASZER
  AUTO_MOTOR
  RUHAZAT
  BARKACS
  SPORT
  JATEK
  HAZTARTAS
  KOZMETIKA
  KONYVEK
  BUTOR
  EGESZSEGUGY
  EGYEB
}

model Product {
  id             Int             @id @default(autoincrement())
  nev            String
  gyarto         String
  kategoria      ProductCategory @default(EGYEB)
  beszerzesiAr   Int             @default(0)
  eladasiAr      Int             
  suly           Float           @default(1.0)
  minimumKeszlet Int             @default(10)
  isDeleted      Boolean         @default(false)
  letrehozva     DateTime        @default(now())
  batches        Batch[]         
  logs           AuditLog[]
  notifications  Notification[]
}

model Batch {
  id          Int       @id @default(autoincrement())
  productId   Int
  product     Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  parcella    String    
  mennyiseg   Int
  lejarat     DateTime? 
  bekerules   DateTime  @default(now())
}

model User {
  id                  Int             @id @default(autoincrement())
  nev                 String
  felhasznalonev      String          @unique
  jelszo              String
  email               String?         @unique
  telefonszam         String?         @unique
  rang                Role            @default(NEZELODO)
  isBanned            Boolean         @default(false)
  mustChangePassword  Boolean         @default(false)
  currentTokenVersion Int             @default(0)
  logs                AuditLog[]
  requests            ChangeRequest[]
  notifications       Notification[]  
}

model Notification {
  id         Int      @id @default(autoincrement())
  userId     Int
  user       User     @relation(fields: [userId], references: [id])
  productId  Int?
  product    Product? @relation(fields: [productId], references: [id], onDelete: SetNull)
  uzenet     String
  tipus      String   
  isRead     Boolean  @default(false)
  letrehozva DateTime @default(now())
}

model AuditLog {
  id         Int      @id @default(autoincrement())
  idopont    DateTime @default(now())
  muvelet    String
  userId     Int
  user       User     @relation(fields: [userId], references: [id])
  productId  Int?     
  product    Product? @relation(fields: [productId], references: [id], onDelete: SetNull)
  regiAdat   Json?
  ujAdat     Json?
}

model ChangeRequest {
  id         Int      @id @default(autoincrement())
  userId     Int
  user       User     @relation(fields: [userId], references: [id])
  tipus      String
  ujErtek    String
  statusz    String   @default("PENDING")
  letrehozva DateTime @default(now())
}
